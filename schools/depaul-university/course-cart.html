<html>
	<head>
		<title>MockSched - Course Cart</title>
		<meta charset="UTF-8">
		<link rel="shortcut icon" href="../../icon.png">

		<link rel="stylesheet" href="../../css/fullcalendar.css" />
		<link rel="stylesheet" href="../../css/fullcalendar.print.css" media="print" />
		<link rel="stylesheet" href="../default/tipuesearch/tipuesearch.css" />
		<link rel="stylesheet" href="../../css/stylesheet.css" />
		<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400|Merriweather:300,300italic" />

		<script src='../../js/moment.min.js'></script>
		<script src='../../js/jquery.min.js'></script>
		<script src='../../js/fullcalendar.min.js'></script>
		<script src="../../js/jquery.tablesorter.min.js"></script>
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','http://www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-70030211-1', 'auto');
			ga('send', 'pageview');
	 	</script>
	</head>
<body>
	<div>
		<span>
			<h3>
				<a href="course-cart.html" style="text-decoration:none; float:right; color:#333;">Course Cart</a>
			</h3>
		</span>
		<span>
			<h1 style="float:left; padding: 0px; padding-right:2%;"><a href="search.html" style="text-decoration:none; color:#333;">MockSched</a></h1>
			<form action="search.html">
				<input type="text" name="q" id="tipue_search_input" autocomplete="off" required placeholder="Enter a Course Name or General Keyword" style="width:40%;">
			</form>
		</span>
	</div>
	<div class="center">
		<div style="padding-bottom: 1%;">
			<a href="course-cart.html" style="text-decoration:none; color:#333;">
				<h1>Course Cart</h1>
			</a>
			<h3>DePaul University</h3>
		</div>
		<div id="empty">
			<h2>Your course cart is currently empty. Search for courses <a href="search.html" style="color: #333;">here.</a></h2>
		</div>
		<div id="body"></div>
		<div style="padding: 2%;">
			<button class="generate" onclick="createCalendarData()" style="visibility: hidden;">Generate Mock Schedule</button>
		</div>
		<div>
			<div class="calendar" id="calendar" style="padding-top:1%; visibility: hidden"></div>
		</div>
	</div>
	<div class="center ital" style="padding: 2%;">Contact the <a href="mailto:mocksched@gmail.com?subject=MockSched">Developer</a></div>
</body>
<script>
	formatCookies()
	$("#myTable").tablesorter({sortInitialOrder: 'desc'});
	function formatCookies()
	{
		classes = []
		html = ''
		for (i of document.cookie.split(';'))
		{
			if(i.indexOf('-add')!=-1) 
			{
				temp = i.substring(i.indexOf('=')+1).split(',')
				if(temp.length==11) temp = ('0.0,' + temp).split(',')
				classes.push(temp)
			}
		}

		document.getElementsByClassName('generate')[0].style.visibility='hidden';
		document.getElementsByClassName('calendar')[0].style.visibility='hidden';
		document.getElementById('empty').innerHTML = '<h2>Your course cart is currently empty. Search for courses <a href="search.html" style="color: #333;">here.</a></h2>'

		if (classes.length > 0)
		{
			document.getElementsByClassName('generate')[0].style.visibility='visible';
			document.getElementById('empty').innerHTML = ''
			html = '<table id="myTable" class="tablesorter">'
			html += '<thead><tr><th class="header">Remove</th><th class="header">Course</th><th class="header">Overall Rating</th><th class="header">Class Status</th><th class="header">Credit Hours</th><th class="header">Teacher First Name</th><th class="header">Teacher Last Name</th><th class="header">Class Start Time</th><th class="header">Class End Time</th><th class="header">Class Section</th><th class="header">Class Number</th><th class="header">Location</th><th class="header">Days</th></tr></thead><tbody>'

			for (i of classes)
			{
				classValue = i[4].toLowerCase() + '-' + i[5].toLowerCase() + '-add'
				html += '<tr class=course><td><input class="' + classValue + '" id="' + i.join(',') + '" type="image" src="../../minus.png" width="20" onclick="removeFromCart(this)"></td>'
				href = 'teachers/' + i[4].toLowerCase()+'-'+i[5].toLowerCase() + '.html'
				if (i[0] == '0.0') 
				{
					course_name = 'classes/'+i[1].replace(' ','-').toLowerCase() + '.html'
					html += '<td><a class="name" style="text-decoration: none;" href="' + course_name + '">' + i[1] + '</a></td>'
					html += '<td class="overall">' + i[0] + '</td>'
					html += '<td class="status">' + i[2] + '</td>'
			    	html += '<td class="hours">' + i[3] + '</td>'
			    	html += '<td class="fname">' + i[4] + '</td>'
			    	html += '<td class="lname">' + i[5] + '</td>'
				}
		    	else 
		    	{
		    		course_name = 'classes/' + i[1].replace(' ','-').toLowerCase() + '.html'
		    		html += '<td><a class="name" style="text-decoration: none;" href="' + course_name + '">' + i[1] + '</a></td>'
		    		html += '<td><a class="overall" style="text-decoration:none;" href="' + href + '">' + i[0] + '</a></td>'
		    		html += '<td class="status">' + i[2] + '</td>'
			    	html += '<td class="hours">' + i[3] + '</td>'
			    	html += '<td><a class="fname" style="text-decoration:none;" href="' + href + '">' + i[4] + '</td>'	
			    	html += '<td><a class="lname" style="text-decoration:none;" href="' + href + '">' + i[5] + '</td>'	
		    	}
		    	html += '<td class="start">' + i[6] + '</td>'
		    	html += '<td class="end">' + i[7] + '</td>'
		    	html += '<td class="section">' + i[8] + '</td>'
		    	html += '<td class="number">' + i[9] + '</td>'
		    	html += '<td class="location">' + i[10] + '</td>'
		    	html += '<td class="days">' + i[11] + '</td>'
				html += '</tr>'
			}
			html += '<tbody></table>'
		}

		document.getElementById('body').innerHTML = html
	}

	function removeFromCart(contents)
	{
		index = 9
		value = contents.getAttribute('id')
		if(value.split(',').length < 12) 
		{
			index = 8
		}
		className = contents.getAttribute('class')
		delete_cookie(className + '-' + value.split(',')[index])
		window.location.reload()
	}

	function delete_cookie(name) 
	{
  		document.cookie = name + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
	}

	function createCalendar(events)
	{
		$('#calendar').fullCalendar({
			header: {
				left: 'prev,next today',
				center: 'title',
				right: 'month,agendaWeek'
			},
			defaultDate: '2016-01-04',
			selectable: true,
			selectHelper: true,
			defaultView: 'agendaWeek',
			select: function(start, end) {
				var title = prompt('Event Title:');
				var eventData;
				if (title) {
					eventData = {
						title: title,
						description: description,
						start: start,
						end: end,
						dow: dow
					};
					$('#calendar').fullCalendar('renderEvent', eventData, true);
				}
				$('#calendar').fullCalendar('unselect');
			},
			editable: false,
			eventLimit: true,
			selectable: false,
			events: events,
			eventRender: function (event, element, view) {
    			element.find('.fc-title').append('<div class="hr-line-solid-no-margin"></div><span style="font-size: 10px">' + event.description + '</span></div>');
			},

		});

		$('html, body').animate({
    		scrollTop: $("#calendar").offset().top
		}, 1000);

	}

	function createCalendarData()
	{
		courses = document.getElementsByClassName("course");
		events = []
		for(var i = 0; i < courses.length; i++)
		{
			start = convertTime(courses[i].getElementsByClassName('start')[0].innerHTML)
			end = convertTime(courses[i].getElementsByClassName('end')[0].innerHTML)
			firstname = courses[i].getElementsByClassName('fname')[0].innerHTML
			lastname = courses[i].getElementsByClassName('lname')[0].innerHTML
			courseLocation = courses[i].getElementsByClassName('location')[0].innerHTML
			days = convertDays(courses[i].getElementsByClassName('days')[0].innerHTML)
			course = courses[i].getElementsByClassName('name')[0].innerHTML
			description = "Teacher: " + firstname + ' ' + lastname +"<br>" + "Location: " + courseLocation
			events.push({'title':course,'description':description,'start':start,'end':end,'dow':days})
		}
		createCalendar(events)
		document.getElementsByClassName('calendar')[0].style.visibility = 'visible';
	}

	function convertDays(days)
	{
		ret = []
		if (days.indexOf('M') != -1) ret.push(1)
		if (days.indexOf('Tu') != -1) ret.push(2)
		if (days.indexOf('W') != -1) ret.push(3)
		if (days.indexOf('Th') != -1) ret.push(4)
		if (days.indexOf('F') != -1) ret.push(5)
		if (days.indexOf('Sat') != -1) ret.push(6)
		return ret
	}

	function convertTime(time)
	{
		if(time=='TBD') return
		hours = time.split(' ')[0].split(':')[0]
		minutes = time.split(' ')[0].split(':')[1]
		if(time.split(' ')[1].toLowerCase() == 'pm' && time.split(' ')[0].split(':')[0].length < 2) 
		{
			hours = String(parseInt(hours)+12)
		}
		ret = hours+':'+minutes+':00'
		if (ret.length ==7) ret = '0' + ret
		return ret
	}
</script>
<style>
	#calendar 
	{
		width: 80%;
		margin: 0 auto;
	}
</style>
</html>
